# Josh Working - 产品开发工作流

> 📋 **面向产品经理的完整工作流指南**
> 即使不懂编程和服务器，也能清晰地管理产品开发和发布

---

## 📌 目录

1. [当前系统现状](#当前系统现状)
2. [工作流总览](#工作流总览)
3. [日常开发流程](#日常开发流程)
4. [发布新功能](#发布新功能)
5. [紧急回滚](#紧急回滚)
6. [常见问题](#常见问题)

---

## 🎯 当前系统现状

### 我们的产品架构

**Seisei 有两个独立的产品入口：**

#### 1️⃣ **BizNexus** - 业务管理前端
- 📱 **访问地址**: https://biznexus.seisei.tokyo
- 🎯 **定位**: 给客户使用的现代化业务管理界面
- 💻 **技术**: Next.js + React 前端应用
- 🔗 **后端**: 连接 Odoo 18 作为数据后端

#### 2️⃣ **Odoo 18 ERP** - 企业资源管理后端
- 📱 **访问地址**: https://*.erp.seisei.tokyo (多租户)
- 🎯 **定位**: 完整的 ERP 后台系统（库存、销售、财务等）
- 💻 **技术**: Odoo 18 企业版
- 👥 **多租户**: 每个客户有独立的子域名
  - 例如：`customer1.erp.seisei.tokyo`
  - 客户自定义域名：`demo.nagashiro.top` (指向我们的租户)

**支撑服务：**
- 📸 **OCR服务** - 票据识别和自动录入
- 🤖 **Langbot** - AI客服机器人
- 🌐 **官网** - 对外展示

### 系统架构图解

```
┌─────────────────────────────────────────────────────────────┐
│                        客户使用层                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  🌐 BizNexus                    📊 Odoo 18 直接访问          │
│  biznexus.seisei.tokyo          *.erp.seisei.tokyo         │
│  ↓                              ↓                           │
│  现代化界面                       完整ERP后台                  │
│  (客户日常使用)                   (管理员/高级用户)             │
│                                                              │
└───────────────┬──────────────────────────┬──────────────────┘
                │                          │
                └──────────┬───────────────┘
                           ↓
                ┌──────────────────────┐
                │   Odoo 18 数据层      │
                │   (共享数据库)         │
                └──────────────────────┘

说明：
• BizNexus 和 Odoo 18 使用同一个数据库
• 客户在 BizNexus 添加的数据，在 Odoo 后台可以看到
• 管理员在 Odoo 后台的修改，BizNexus 会同步显示
```

### 部署环境

我们有两个独立的运行环境：

| 环境 | 用途 | Odoo访问地址 | BizNexus访问地址 | 谁在用 |
|------|------|-------------|-----------------|--------|
| **Staging（测试）** | 测试新功能 | https://staging.erp.seisei.tokyo | (使用生产BizNexus) | 内部团队 |
| **Production（生产）** | 正式运营 | https://*.erp.seisei.tokyo<br>https://demo.nagashiro.top | https://biznexus.seisei.tokyo | 客户使用 |

**重要理解：**
- 🧪 **Staging** = 实验室，测试 Odoo 新功能，出问题不影响客户
- 🏭 **Production** = 工厂，客户在用，必须保持稳定
- 🔀 **两个界面** =
  - 客户通常使用 **BizNexus** (更现代、易用)
  - 高级用户/管理员可以直接登录 **Odoo 后台** (功能更全)

### 服务器位置

- **地点**: 日本 AWS (Tokyo Region)
- **IP**: 54.65.127.141
- **管理**: 已配置自动化部署，无需手动登录

### 代码仓库

- **GitHub**: https://github.com/cameltravel666-crypto/seisei-odoo-addons
- **主分支**: `main` - 所有代码合并到这里
- **镜像仓库**: GitHub Container Registry (GHCR) - 存储构建好的软件包

---

## 🔄 工作流总览

### 开发到上线的完整旅程

```
📝 提需求 → 👨‍💻 开发 → 🧪 测试环境 → ✅ 验收 → 🚀 生产环境 → 📊 监控
```

### 自动化流程图

```
开发人员提交代码到 GitHub
         ↓
自动构建软件包 (GitHub Actions)
         ↓
部署到测试环境 (Staging)
         ↓
产品经理验收 ← 你的工作在这里
         ↓
一键发布到生产环境 (Production)
         ↓
客户使用新功能
```

**你需要做的：**
1. ✅ 在测试环境验收新功能
2. ✅ 批准发布到生产环境
3. ✅ 监控生产环境运行状态

---

## 📅 日常开发流程

### 场景1：开发人员完成了新功能

**你会收到通知：**
```
开发人员: "Josh，XX功能已经部署到测试环境了，麻烦验收一下"
```

**你要做什么：**

#### Step 1: 访问测试环境验收

**根据功能类型选择验收入口：**

**A. 如果是 Odoo 后台功能（库存、销售、财务等）**
1. 打开浏览器访问：https://staging.erp.seisei.tokyo
2. 使用测试账号登录 Odoo
3. 按照功能需求文档测试新功能

**B. 如果是 BizNexus 前端功能（客户界面）**
1. 打开浏览器访问：https://biznexus.seisei.tokyo
2. 使用测试账号登录
3. 验证前端界面的新功能
4. （可选）如果需要，也检查 Odoo 后台数据是否正确

**验收检查表：**
- [ ] 功能是否按照需求实现
- [ ] 界面是否美观、易用
- [ ] 操作流程是否顺畅
- [ ] 有没有明显的bug
- [ ] 性能是否可接受（加载速度）
- [ ] 两个界面的数据是否同步（如适用）

#### Step 2: 反馈结果

**如果发现问题：**
```
在项目管理工具（如Notion/Jira）中记录：
- 问题描述
- 重现步骤
- 期望行为 vs 实际行为
- 截图/录屏
```

**如果验收通过：**
```
✅ 通知开发团队：
"XX功能已验收通过，可以发布到生产环境"
```

### 场景2：监控测试环境状态

**每天检查一次：**

1. 访问 https://staging.erp.seisei.tokyo
2. 确认页面能正常打开
3. 登录系统检查基本功能

**如果发现测试环境无法访问：**
- 不要慌张（测试环境问题不影响客户）
- 通知技术团队：`@开发 测试环境无法访问，请检查`

---

## 🚀 发布新功能

### 什么时候发布到生产环境

**必须满足：**
1. ✅ 测试环境已完整验收
2. ✅ 所有发现的bug已修复
3. ✅ 团队确认可以发布
4. ✅ 选择合适的发布时间（避开业务高峰）

**推荐发布时间：**
- 🕐 周二/周三 下午3-5点
- ❌ 避免周五下午（万一有问题周末没人修）
- ❌ 避免月初/月末（财务关账期）

### 发布操作步骤

#### Step 1: 访问 GitHub Actions

1. 打开浏览器访问：https://github.com/cameltravel666-crypto/seisei-odoo-addons/actions
2. 找到左侧菜单中的 **"Deploy to Server"**
3. 点击右上角 **"Run workflow"** 按钮

#### Step 2: 填写发布参数

会看到一个表单，需要填写：

| 参数 | 填什么 | 常用选项 | 说明 |
|------|--------|---------|------|
| **Stack to deploy** | 选择要发布的服务 | `odoo18-prod`<br>`web-seisei`<br>`ocr` | Odoo后台<br>BizNexus前端<br>OCR服务 |
| **SHA tag** | 输入版本号 | `sha-19b9b98` | 7位版本号 |
| **Auto-promote** | 不勾选 | ⬜️ | 用于staging自动推生产 |

**Stack 选择指南：**
- 📊 **odoo18-prod** - 发布 Odoo 后台功能（库存、销售、财务等）
- 🌐 **web-seisei** - 发布 BizNexus 前端（客户界面）
- 📸 **ocr** - 发布 OCR 票据识别服务
- 🤖 **langbot** - 发布 AI 客服机器人

**如何找到版本号 (SHA tag)？**
1. 打开 GitHub 主页
2. 查看最近的提交记录
3. 复制前7位字符（例如：19b9b98）

#### Step 3: 确认发布

1. 点击绿色的 **"Run workflow"** 按钮
2. 等待 1-2 分钟
3. 页面会显示部署进度

**看到这些状态：**
- 🔵 蓝色圆圈 = 正在部署
- ✅ 绿色勾 = 部署成功
- ❌ 红色叉 = 部署失败（通知技术团队）

#### Step 4: 验证生产环境

部署成功后立即验证（**根据发布的Stack选择验证地址**）：

**验证地址选择：**
- 📊 **odoo18-prod** → 访问 https://demo.nagashiro.top 或 https://*.erp.seisei.tokyo
- 🌐 **web-seisei** → 访问 https://biznexus.seisei.tokyo
- 📸 **ocr** → 测试OCR功能（通过BizNexus或Odoo上传票据）
- 🤖 **langbot** → 测试客服机器人

**验证步骤：**
1. 清除浏览器缓存（Ctrl+Shift+Delete / Cmd+Shift+Delete）
2. 访问对应的网址
3. 强制刷新页面（Ctrl+F5 / Cmd+Shift+R）
4. 测试核心功能是否正常

**快速检查清单：**
- [ ] 页面能正常打开
- [ ] 登录功能正常
- [ ] 新功能已生效
- [ ] 旧功能没有被破坏
- [ ] （如果涉及两个界面）数据在BizNexus和Odoo之间同步正常

#### Step 5: 通知团队

发布成功后，在团队群发消息：
```
✅ 生产环境已更新
版本: sha-19b9b98
发布内容: [列出主要更新]
发布时间: 2024-01-30 15:00
验证状态: 已验证，运行正常
```

---

## 🔙 紧急回滚

### 什么时候需要回滚

**紧急情况：**
- ❗️ 新功能导致系统崩溃
- ❗️ 发现严重bug影响客户使用
- ❗️ 性能突然变差（页面加载超过10秒）
- ❗️ 数据显示错误

**判断标准：**
> 如果问题影响客户正常使用业务，立即回滚

### 回滚操作步骤

#### Step 1: 访问回滚工作流

1. 打开：https://github.com/cameltravel666-crypto/seisei-odoo-addons/actions/workflows/rollback.yml
2. 点击 **"Run workflow"**

#### Step 2: 填写回滚参数

| 参数 | 填什么 | 说明 |
|------|--------|------|
| **Stack to rollback** | `odoo18-prod` | 要回滚的服务 |
| **Number of deployments to rollback** | `1` | 回退几个版本 |
| **Target SHA** | 留空 | 让系统自动选择 |

**通常填写：**
- Stack: `odoo18-prod`
- Steps back: `1` (回到上一个稳定版本)

#### Step 3: 执行回滚

1. 点击 **"Run workflow"**
2. 等待 30-60 秒
3. 看到 ✅ 绿色勾表示回滚成功

#### Step 4: 验证回滚结果

1. 访问 https://demo.nagashiro.top
2. 强制刷新页面（清除缓存）
3. 确认问题已解决

#### Step 5: 紧急通知

```
⚠️ 紧急回滚通知

生产环境已回滚到上一个稳定版本
回滚原因: [简述问题]
回滚时间: [当前时间]
当前状态: 系统已恢复正常
后续计划: 技术团队将修复问题后重新发布
```

---

## 🔍 常见问题

### Q1: 如何查看当前生产环境运行的是哪个版本？

**方法1: 查看部署历史**
1. 访问：https://github.com/cameltravel666-crypto/seisei-odoo-addons/actions
2. 查看 "Deploy to Server" 的最后成功记录
3. 点击进入查看详情，可以看到版本号

**方法2: 询问技术团队**
```
@开发 请问生产环境当前是哪个版本？
```

### Q2: 测试环境和生产环境可以同时部署吗？

**可以**，它们是完全独立的：
- Staging (测试) 可以随时部署最新代码
- Production (生产) 只部署经过验收的稳定版本

### Q3: 发布失败了怎么办？

1. **不要慌张** - 发布失败时，旧版本仍在运行
2. **查看错误信息** - GitHub Actions 会显示失败原因
3. **通知技术团队** - 截图错误信息发送给开发
4. **等待修复** - 技术团队会修复后重新部署

### Q4: 如何知道是否需要回滚？

**需要回滚的信号：**
- 📞 客户打电话反馈系统无法使用
- 📧 收到大量客户投诉邮件
- 📊 监控显示错误率突增
- 🔍 自己测试发现严重bug

**不需要回滚的情况：**
- 小的UI问题（可以下次发布修复）
- 单个客户的个别问题（可能是客户端缓存）
- 测试环境的问题（不影响生产）

### Q5: 周末或半夜出现紧急问题怎么办？

**紧急联系流程：**
1. 评估严重程度（是否影响客户核心业务）
2. 如果非常紧急，电话联系技术负责人
3. 如果可以等待，发送紧急邮件并在工作时间处理

**紧急程度判断：**
- 🔴 紧急：系统完全无法访问 → 立即电话
- 🟡 重要：部分功能异常 → 紧急邮件
- 🟢 一般：小问题 → 工作日处理

### Q6: BizNexus 和 Odoo 有什么区别？应该用哪个？

**简单理解：**
- 🌐 **BizNexus** = 精美的店面（给客户用的友好界面）
- 📊 **Odoo 18** = 仓库后台（给管理员用的完整功能）

**具体区别：**

| 维度 | BizNexus | Odoo 18 后台 |
|------|---------|-------------|
| **界面** | 现代化、简洁 | 功能完整、复杂 |
| **适合** | 普通客户使用 | 管理员、高级用户 |
| **功能** | 常用功能 | 全部功能（配置、导入导出等） |
| **数据** | 同一个数据库 | 同一个数据库 |

**使用场景举例：**
- 📱 客户查看库存 → 用 **BizNexus**
- ⚙️ 配置价格规则 → 用 **Odoo 后台**
- 📝 录入销售订单 → 两者都可以
- 📊 查看财务报表 → 两者都可以（Odoo更详细）

**验收建议：**
- 如果是客户会用的功能 → 主要在 BizNexus 验收
- 如果是管理功能 → 在 Odoo 后台验收
- 如果涉及数据同步 → 两个界面都要验证

### Q7: 如何准备发布？

**发布前检查清单：**

**提前1天：**
- [ ] 确认测试环境所有功能验收完成
- [ ] 准备发布说明（更新了什么）
- [ ] 通知客户可能的停机时间（如果需要）

**发布前1小时：**
- [ ] 确认技术团队在线（可以随时处理问题）
- [ ] 准备好回滚方案
- [ ] 清空自己的浏览器缓存

**发布后：**
- [ ] 立即验证主要功能
- [ ] 监控15分钟确保稳定
- [ ] 发送发布完成通知

---

## 📊 监控检查表

### 每日检查 (5分钟)

- [ ] 访问生产环境网站能正常打开
- [ ] 登录功能正常
- [ ] 查看是否有客户反馈问题

### 每周检查 (15分钟)

- [ ] 测试环境功能验收
- [ ] 查看 GitHub Actions 运行历史
- [ ] 与技术团队对齐下周发布计划

### 每月检查 (30分钟)

- [ ] 回顾本月发布次数和质量
- [ ] 总结发现的问题和改进点
- [ ] 更新产品路线图

---

## 🎓 专业术语速查表

作为产品经理，你会听到这些词：

| 技术术语 | 产品经理理解 | 举例 |
|---------|-------------|------|
| **Deploy（部署）** | 把新功能发布到服务器 | "我们今天要deploy新的报表功能" |
| **Staging** | 测试环境 | "先在staging测试一下" |
| **Production / Prod** | 生产环境（客户在用） | "这个bug在prod很严重" |
| **Rollback（回滚）** | 撤销发布，回到旧版本 | "有问题，赶紧rollback" |
| **Build（构建）** | 把代码打包成可运行的软件 | "build成功了，可以部署" |
| **SHA / Commit** | 代码版本号 | "部署sha-19b9b98这个版本" |
| **Docker Image** | 软件包 | "我们用的是Odoo18的镜像" |
| **Workflow** | 自动化流程 | "跑一下deploy workflow" |
| **Hot Fix** | 紧急修复 | "这个bug需要hot fix" |

---

## 📞 联系方式

**遇到问题时：**

| 问题类型 | 联系谁 | 方式 |
|---------|--------|------|
| 🐛 功能bug | 技术主管 | Slack/微信 |
| 🚨 系统崩溃 | 技术负责人 | 电话 |
| 📋 需求澄清 | 开发团队 | 项目管理工具 |
| 🤔 操作不确定 | 查看本文档 | JOSH_WORKING.md |

---

## ✅ 快速操作指南

### 我要发布新功能到生产环境

**发布 Odoo 后台功能：**
```
1. 访问: https://github.com/cameltravel666-crypto/seisei-odoo-addons/actions
2. 点击: Deploy to Server
3. 点击: Run workflow
4. 选择: odoo18-prod
5. 填写: sha-xxxxxxx (问开发要版本号)
6. 点击: Run workflow
7. 等待: 看到绿色✅
8. 验证: 访问 https://demo.nagashiro.top
```

**发布 BizNexus 前端：**
```
1. 访问: https://github.com/cameltravel666-crypto/seisei-odoo-addons/actions
2. 点击: Deploy to Server
3. 点击: Run workflow
4. 选择: web-seisei
5. 填写: sha-xxxxxxx (问开发要版本号)
6. 点击: Run workflow
7. 等待: 看到绿色✅
8. 验证: 访问 https://biznexus.seisei.tokyo
```

### 我要紧急回滚

```
1. 访问: https://github.com/cameltravel666-crypto/seisei-odoo-addons/actions
2. 点击: Rollback Deployment
3. 点击: Run workflow
4. 选择: odoo18-prod
5. 填写: Steps back = 1
6. 点击: Run workflow
7. 等待: 看到绿色✅
8. 验证: 问题已解决
```

### 我要查看部署历史

```
1. 访问: https://github.com/cameltravel666-crypto/seisei-odoo-addons/actions
2. 查看: Deploy to Server 的运行记录
3. 绿色✅ = 成功, 红色❌ = 失败
4. 点击记录可以看详细信息
```

---

## 🎯 成功标准

**作为产品经理，你做到这些就很棒了：**

1. ✅ 能独立完成发布到生产环境
2. ✅ 遇到问题知道如何紧急回滚
3. ✅ 能准确描述问题给技术团队
4. ✅ 了解当前运行的版本
5. ✅ 知道如何查看部署历史

**不需要做到：**
- ❌ 理解代码
- ❌ 修改配置文件
- ❌ 登录服务器
- ❌ 解决技术问题

**你的核心职责：**
> 确保正确的功能在正确的时间发布给客户，并且运行稳定

---

## 📝 发布记录模板

每次发布后，可以用这个模板记录：

```markdown
## 发布记录 - 2024-01-30

**版本**: sha-19b9b98
**环境**: Production
**发布人**: Josh
**发布时间**: 2024-01-30 15:00

**发布内容**:
- [ ] 新增XX功能
- [ ] 优化XX性能
- [ ] 修复XX bug

**验收状态**:
- [x] Staging验收通过
- [x] Production部署成功
- [x] 功能验证正常

**客户反馈**:
- 暂无问题反馈

**备注**:
- 发布过程顺利
- 客户使用正常
```

---

**文档版本**: v1.0
**最后更新**: 2024-01-30
**维护人**: Josh (Product Manager)

---

> 💡 **记住**: 你不需要成为技术专家，只需要知道**何时**、**如何**发布产品功能，并确保客户获得稳定可靠的服务。

> 🤝 **团队协作**: 产品经理负责决策，技术团队负责执行，一起把产品做好！
