<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Import Run Tree View -->
    <record id="view_gdoc_import_run_tree" model="ir.ui.view">
        <field name="name">seisei.gdoc.import.run.tree</field>
        <field name="model">seisei.gdoc.import.run</field>
        <field name="arch" type="xml">
            <list decoration-success="state == 'imported'" decoration-danger="state == 'failed'">
                <field name="name"/>
                <field name="template_id"/>
                <field name="state" widget="badge"
                       decoration-info="state == 'draft'"
                       decoration-warning="state in ('fetched', 'validated')"
                       decoration-success="state == 'imported'"
                       decoration-danger="state == 'failed'"/>
                <field name="run_by"/>
                <field name="run_at"/>
                <field name="total_rows"/>
                <field name="created_count"/>
                <field name="updated_count"/>
                <field name="error_count"/>
            </list>
        </field>
    </record>

    <!-- Import Run Form View -->
    <record id="view_gdoc_import_run_form" model="ir.ui.view">
        <field name="name">seisei.gdoc.import.run.form</field>
        <field name="model">seisei.gdoc.import.run</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_fetch"
                            string="Fetch Data"
                            type="object"
                            class="btn-primary"
                            invisible="state != 'draft'"/>
                    <button name="action_validate"
                            string="Validate"
                            type="object"
                            class="btn-primary"
                            invisible="state not in ('fetched', 'draft')"/>
                    <button name="action_import"
                            string="Execute Import"
                            type="object"
                            class="btn-primary"
                            invisible="state not in ('validated', 'fetched')"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,fetched,validated,imported"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_logs"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-list">
                            <field name="log_count" widget="statinfo" string="Logs"/>
                        </button>
                    </div>
                    <group>
                        <group>
                            <field name="template_id"/>
                            <field name="run_by"/>
                            <field name="run_at"/>
                        </group>
                        <group>
                            <field name="total_rows"/>
                            <field name="created_count"/>
                            <field name="updated_count"/>
                            <field name="skipped_count"/>
                            <field name="error_count"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Raw Data" name="raw_data">
                            <field name="raw_data_json" widget="ace" options="{'mode': 'json'}" readonly="1"/>
                        </page>
                        <page string="Preview" name="preview">
                            <field name="preview_json" widget="ace" options="{'mode': 'json'}" readonly="1"/>
                        </page>
                        <page string="Validation Errors" name="errors" invisible="not validation_errors_json">
                            <field name="validation_errors_json" widget="ace" options="{'mode': 'json'}" readonly="1"/>
                        </page>
                        <page string="Logs" name="logs">
                            <field name="log_ids" readonly="1">
                                <list decoration-danger="level == 'error'" decoration-warning="level == 'warning'">
                                    <field name="create_date"/>
                                    <field name="level" widget="badge"
                                           decoration-info="level == 'info'"
                                           decoration-warning="level == 'warning'"
                                           decoration-danger="level == 'error'"/>
                                    <field name="model"/>
                                    <field name="external_key"/>
                                    <field name="message"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Import Run Action -->
    <record id="action_gdoc_import_run" model="ir.actions.act_window">
        <field name="name">Import Runs</field>
        <field name="res_model">seisei.gdoc.import.run</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- Import Log Tree View -->
    <record id="view_gdoc_import_log_tree" model="ir.ui.view">
        <field name="name">seisei.gdoc.import.log.tree</field>
        <field name="model">seisei.gdoc.import.log</field>
        <field name="arch" type="xml">
            <list decoration-danger="level == 'error'" decoration-warning="level == 'warning'">
                <field name="create_date"/>
                <field name="run_id"/>
                <field name="level" widget="badge"/>
                <field name="model"/>
                <field name="external_key"/>
                <field name="message"/>
            </list>
        </field>
    </record>

</odoo>
