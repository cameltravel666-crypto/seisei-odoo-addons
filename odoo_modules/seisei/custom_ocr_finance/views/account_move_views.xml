<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Inherit Account Move Form View -->
    <record id="view_move_form_ocr" model="ir.ui.view">
        <field name="name">account.move.form.ocr</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- Add OCR button in header - supports all invoice types -->
            <xpath expr="//header" position="inside">
                <button name="action_send_to_ocr"
                        string="AI Analyze"
                        type="object"
                        class="btn-primary"
                        invisible="ocr_status == 'processing' or move_type not in ('in_invoice', 'in_refund', 'out_invoice', 'out_refund')"
                        icon="fa-eye"/>
                <button name="action_ocr_apply_lines"
                        string="Apply AI Results"
                        type="object"
                        class="btn-secondary"
                        invisible="not ocr_line_items or ocr_status != 'done'"
                        icon="fa-list-alt"/>
                <button name="action_reset_ocr"
                        string="Reset AI"
                        type="object"
                        class="btn-secondary"
                        invisible="ocr_status == 'pending'"
                        icon="fa-refresh"/>
            </xpath>

            <!-- Add OCR status field after state -->
            <xpath expr="//field[@name='state']" position="after">
                <field name="ocr_status" widget="badge"
                       decoration-info="ocr_status == 'pending'"
                       decoration-warning="ocr_status == 'processing'"
                       decoration-success="ocr_status == 'done'"
                       decoration-danger="ocr_status == 'failed'"/>
            </xpath>

            <!-- Add OCR tab in notebook -->
            <xpath expr="//notebook" position="inside">
                <page string="AI Results" name="ocr_data">
                    <group>
                        <group string="AI Status">
                            <field name="ocr_status" readonly="1"/>
                            <field name="ocr_processed_at" readonly="1"/>
                            <field name="ocr_confidence" readonly="1" widget="percentage"/>
                        </group>
                        <group string="AI Results">
                            <field name="ocr_pages" readonly="1"/>
                            <field name="ocr_matched_count" readonly="1"/>
                        </group>
                    </group>
                    <group string="AI Error" invisible="not ocr_error_message">
                        <field name="ocr_error_message" readonly="1" colspan="2"/>
                    </group>
                    <group string="Extracted Line Items (JSON)" invisible="not ocr_line_items">
                        <field name="ocr_line_items" readonly="1" widget="text" nolabel="1" colspan="2"/>
                    </group>
                    <group string="Extracted Text" invisible="not ocr_extracted_texts">
                        <field name="ocr_extracted_texts" readonly="1" widget="text" nolabel="1" colspan="2"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

</odoo>
