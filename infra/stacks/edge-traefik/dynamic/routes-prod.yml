http:
  routers:
    # CRM API: www.seisei.tokyo/crm-api/* -> Odoo 19
    crm-api-prod:
      rule: "(Host(`seisei.tokyo`) || Host(`www.seisei.tokyo`)) && PathPrefix(`/crm-api`)"
      service: odoo19-crm
      priority: 200
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare
      middlewares:
        - crm-strip-prefix
        - crm-odoo19-dbfilter
        - secure-headers@file

    # Seisei Corporate Website
    seisei-www:
      rule: "Host(`seisei.tokyo`) || Host(`www.seisei.tokyo`)"
      service: seisei-www
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare
      middlewares:
        - secure-headers@file
        - rate-limit@file

    # Odoo Production - ERP domains only
    odoo-prod:
      rule: "Host(`odoo.seisei.tokyo`) || Host(`erp.seisei.tokyo`)"
      service: odoo-prod
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare

    # Odoo Production - demo.nagashiro.top (HTTP Challenge)
    odoo-demo-nagashiro:
      rule: "Host(`demo.nagashiro.top`)"
      service: odoo-prod
      entryPoints:
        - websecure
      tls:
        certResolver: httpchallenge
      middlewares:
        - secure-headers@file
        - rate-limit@file
        - nagashiro-dbfilter@file

    # Odoo Production - Wildcard subdomains for multi-tenancy
    odoo-prod-wildcard:
      rule: "HostRegexp(`{subdomain:[a-z0-9-]+}.erp.seisei.tokyo`)"
      service: odoo-prod
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare
        domains:
          - main: "erp.seisei.tokyo"
            sans:
              - "*.erp.seisei.tokyo"

    # BizNexus Production
    biznexus-prod:
      rule: "Host(`biznexus.seisei.tokyo`)"
      service: biznexus-prod
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare

  middlewares:
    crm-strip-prefix:
      stripPrefix:
        prefixes:
          - "/crm-api"

    crm-odoo19-dbfilter:
      headers:
        customRequestHeaders:
          X-Odoo-Database: "odoo19"

  services:
    # Odoo 19 CRM API Service (external server)
    odoo19-crm:
      loadBalancer:
        servers:
          - url: "http://13.159.193.191:8069"

    # Seisei Corporate Website Service
    seisei-www:
      loadBalancer:
        servers:
          - url: "http://seisei-www:3000"

    # Odoo Production Service
    odoo-prod:
      loadBalancer:
        servers:
          - url: "http://odoo18-prod-web:8069"

    # BizNexus Production Service
    biznexus-prod:
      loadBalancer:
        servers:
          - url: "http://biznexus-app:9527"
