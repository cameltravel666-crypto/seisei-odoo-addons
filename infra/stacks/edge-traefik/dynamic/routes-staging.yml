http:
  routers:
    # CRM API: staging.www.seisei.tokyo/crm-api/* -> Odoo 19
    crm-api-staging:
      rule: "Host(`staging.www.seisei.tokyo`) && PathPrefix(`/crm-api`)"
      service: odoo19-crm
      priority: 200
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare
      middlewares:
        - crm-strip-prefix
        - secure-headers@file

    # Seisei Corporate Website Staging
    seisei-www-staging:
      rule: "Host(`staging.seisei.tokyo`) || Host(`staging.www.seisei.tokyo`)"
      service: seisei-www-staging
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare
      middlewares:
        - secure-headers@file
        - rate-limit@file

    # BizNexus Staging
    biznexus-staging:
      rule: "Host(`staging.biznexus.seisei.tokyo`)"
      service: biznexus-staging
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare
      middlewares:
        - secure-headers@file
        - rate-limit@file

    # Odoo Staging - ERP only
    odoo-staging-domain:
      rule: "Host(`staging.erp.seisei.tokyo`) || Host(`staging.odoo.seisei.tokyo`)"
      service: odoo-staging
      entryPoints:
        - websecure
      tls:
        certResolver: cloudflare
      middlewares:
        - secure-headers@file
        - rate-limit@file

    # HTTP redirect for all
    staging-http-redirect:
      rule: "Host(`staging.seisei.tokyo`) || Host(`staging.www.seisei.tokyo`) || Host(`staging.biznexus.seisei.tokyo`) || Host(`staging.erp.seisei.tokyo`) || Host(`staging.odoo.seisei.tokyo`)"
      service: odoo-staging
      entryPoints:
        - web
      middlewares:
        - https-redirect@file

  middlewares:
    crm-strip-prefix:
      stripPrefix:
        prefixes:
          - "/crm-api"

  services:
    # Odoo 19 CRM API Service (external server)
    odoo19-crm:
      loadBalancer:
        servers:
          - url: "http://13.159.193.191:8069"

    # Seisei Corporate Website Service
    seisei-www-staging:
      loadBalancer:
        servers:
          - url: "http://seisei-www:3000"

    # BizNexus Staging Service
    biznexus-staging:
      loadBalancer:
        servers:
          - url: "http://biznexus-app:9527"

    # Odoo Staging Service
    odoo-staging:
      loadBalancer:
        servers:
          - url: "http://odoo18-staging-web:8069"
