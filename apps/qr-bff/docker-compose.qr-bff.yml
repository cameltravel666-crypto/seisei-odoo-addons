# =============================================================================
# QR-BFF Service - Docker Compose Extension
# =============================================================================
# Usage: Merge with main odoo18-prod docker-compose.yml
#   docker compose -f docker-compose.yml -f docker-compose.qr-bff.yml up -d
#
# Required .env variables:
#   REDIS_PASSWORD - Redis authentication password
#   QR_SERVICE_LOGIN - Odoo service user login (default: test)
#   QR_SERVICE_PASSWORD - Odoo service user password
# =============================================================================

services:
  # ===========================================================================
  # QR-BFF - Backend for Frontend for QR Ordering
  # ===========================================================================
  qr-bff:
    image: ghcr.io/cameltravel666-crypto/seisei-odoo-addons/qr-bff:latest
    container_name: qr-bff
    restart: unless-stopped
    environment:
      - PORT=3100
      - REDIS_HOST=odoo-redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=${REDIS_PASSWORD:-changeme}
      - REDIS_DB=1
      - ODOO_URL=http://seisei-odoo-router:80
      - ODOO_SERVICE_LOGIN=${QR_SERVICE_LOGIN:-test}
      - ODOO_SERVICE_PASSWORD=${QR_SERVICE_PASSWORD:-test123}
      - ODOO_TIMEOUT=30000
      - ODOO_RETRIES=2
      - DEFAULT_DB=ten_testodoo
    networks:
      - seisei-odoo-network
      - odoo18-prod_odoo-internal
      - edge
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3100/v1/qr/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

networks:
  seisei-odoo-network:
    external: true
  odoo18-prod_odoo-internal:
    external: true
  edge:
    external: true
