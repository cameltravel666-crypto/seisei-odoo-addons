# =============================================================================
# QR-BFF Service - Docker Compose Extension
# =============================================================================
# Usage: Merge with main odoo18-prod docker-compose.yml
#   docker compose -f docker-compose.yml -f docker-compose.qr-bff.yml up -d
# =============================================================================

services:
  # ===========================================================================
  # QR-BFF - Backend for Frontend for QR Ordering
  # ===========================================================================
  qr-bff:
    build:
      context: ../apps/qr-bff
      dockerfile: Dockerfile
    image: qr-bff:latest
    container_name: qr-bff
    restart: unless-stopped
    depends_on:
      redis:
        condition: service_healthy
    environment:
      - PORT=3100
      - REDIS_HOST=odoo-redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DB=1
      - ODOO_URL=http://seisei-odoo-router:80
      - ODOO_SERVICE_LOGIN=${QR_SERVICE_LOGIN:-qr_service}
      - ODOO_SERVICE_PASSWORD=${QR_SERVICE_PASSWORD}
      - ODOO_TIMEOUT=10000
      - ODOO_RETRIES=1
      - DEFAULT_DB=ten_testodoo
    networks:
      - seisei-odoo-network
      - odoo-internal
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3100/v1/qr/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
